<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="/static/css/style.css" rel="stylesheet">
    <style>
        html,body{height:100%;margin:0}
        body{display:flex;flex-direction:column}
        .navbar{flex-shrink:0}
        .editor-wrap{flex:1;display:flex;flex-direction:column;padding:8px;min-height:0;background:var(--bg-tertiary)}
        .editor-box{flex:1;display:flex;flex-direction:column;border:1px solid var(--border);border-radius:8px;overflow:hidden;background:var(--bg-primary);min-height:0}
        .editor-box:focus-within{border-color:var(--accent);box-shadow:0 0 0 2px var(--accent-light)}
        .toolbar{display:flex;align-items:center;gap:6px;padding:6px 10px;background:var(--bg-secondary);border-bottom:1px solid var(--border);flex-wrap:wrap}
        .t-input{border:none;background:transparent;font-size:14px;font-weight:500;color:var(--text-primary);padding:4px 0;flex:1;min-width:100px;outline:none}
        .t-input::placeholder{color:var(--text-tertiary)}
        .t-sel{background:var(--bg-primary);border:1px solid var(--border);border-radius:4px;padding:4px 6px;font-size:11px;color:var(--text-primary);cursor:pointer}
        .t-sel:focus{outline:none;border-color:var(--accent)}
        .t-sep{width:1px;height:18px;background:var(--border)}
        .t-opt{display:flex;align-items:center;gap:4px;padding:4px 8px;font-size:11px;border:1px solid var(--border);border-radius:4px;background:var(--bg-primary);color:var(--text-secondary);cursor:pointer}
        .t-opt:hover{color:var(--accent);border-color:var(--accent)}
        .t-opt.on{background:var(--accent);border-color:var(--accent);color:#000}
        .t-opt svg{width:12px;height:12px}
        .t-btn{padding:5px 14px;font-size:12px;font-weight:600;border:1px solid var(--accent);border-radius:4px;background:var(--accent);color:#000;cursor:pointer;margin-left:auto}
        .t-btn:hover{background:var(--accent-hover)}
        .editor-main{flex:1;display:flex;min-height:0}
        .gutter{width:36px;flex-shrink:0;padding:8px 0;background:var(--bg-secondary);border-right:1px solid var(--border);font:11px/1.75 'JetBrains Mono',monospace;color:var(--text-tertiary);text-align:right;overflow-y:auto;user-select:none}
        .gutter div{padding-right:8px}
        .code-area{flex:1;position:relative;display:flex;flex-direction:column;min-width:0}
        .preview{position:absolute;top:0;left:0;right:0;bottom:0;padding:8px 10px;font:13px/1.75 'JetBrains Mono',monospace;overflow:auto;pointer-events:none;white-space:pre;tab-size:4}
        .preview code{background:none!important;padding:0!important}
        .code-ta{flex:1;border:none;resize:none;padding:8px 10px;font:13px/1.75 'JetBrains Mono',monospace;color:var(--text-primary);background:transparent;outline:none;overflow-y:auto;white-space:pre;tab-size:4;position:relative;z-index:1}
        .code-ta::placeholder{color:var(--text-tertiary)}
        .code-ta.hl{color:transparent;caret-color:var(--text-primary)}
        .status{display:flex;align-items:center;gap:12px;padding:4px 10px;background:var(--bg-secondary);border-top:1px solid var(--border);font-size:10px;color:var(--text-tertiary)}
        .status .a{color:var(--accent)}
        .badge{padding:2px 6px;background:var(--accent-light);color:var(--accent);border-radius:3px;font-weight:500}
        .k{background:var(--bg-tertiary);padding:1px 4px;border-radius:2px;font-family:var(--font-mono)}
        @media(max-width:600px){.t-sep{display:none}.t-opt span{display:none}.t-sel{font-size:10px}}
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:20px;height:20px"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
                Patbin
            </a>
            <div class="nav-links">
                <button class="theme-toggle" onclick="toggleTheme()"><svg class="sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/></svg><svg class="moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></button>
                {{if .username}}<a href="/dashboard" class="btn btn-ghost btn-sm">Dashboard</a>{{else}}<a href="/login" class="btn btn-ghost btn-sm">Login</a>{{end}}
            </div>
        </div>
    </nav>
    <form id="paste-form" class="editor-wrap">
        <div class="editor-box">
            <div class="toolbar">
                <input type="text" name="title" class="t-input" placeholder="Untitled" autocomplete="off">
                <select name="language" class="t-sel" id="lang-select">
                    <option value="">Language</option>
                    <option value="javascript">JavaScript</option>
                    <option value="typescript">TypeScript</option>
                    <option value="python">Python</option>
                    <option value="go">Go</option>
                    <option value="rust">Rust</option>
                    <option value="java">Java</option>
                    <option value="c">C</option>
                    <option value="cpp">C++</option>
                    <option value="csharp">C#</option>
                    <option value="php">PHP</option>
                    <option value="ruby">Ruby</option>
                    <option value="html">HTML</option>
                    <option value="css">CSS</option>
                    <option value="json">JSON</option>
                    <option value="sql">SQL</option>
                    <option value="bash">Bash</option>
                </select>
                <select name="expires_in" class="t-sel">
                    <option value="never">Never</option>
                    <option value="1h">1h</option>
                    <option value="1d">1d</option>
                    <option value="1w">1w</option>
                </select>
                <span class="t-sep"></span>
                <button type="button" class="t-opt on" id="pub" onclick="toggleP()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/></svg><span>Public</span></button>
                <button type="button" class="t-opt" id="burn" onclick="toggleB()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22C6 18 3 13 3 10c0-3 2-5 4-6s5 1 5 3c0-2 2.5-4 5-3s4 3 4 6c0 3-3 8-9 12z"/></svg><span>Burn</span></button>
                <input type="hidden" name="is_public" id="is_public" value="true">
                <input type="hidden" name="burn_after_read" id="burn_after_read" value="false">
                <button type="submit" class="t-btn">Create</button>
            </div>
            <div class="editor-main">
                <div class="gutter" id="gut"><div>1</div></div>
                <div class="code-area">
                    <div class="preview" id="pre"></div>
                    <textarea name="content" class="code-ta" id="ed" placeholder="// Paste code here" required spellcheck="false"></textarea>
                </div>
            </div>
            <div class="status">
                <span id="ln">1 line</span>
                <span id="ch">0 chars</span>
                <span class="badge" id="lg">Plain</span>
                <span style="flex:1"></span>
                <span><span class="k">Tab</span> indent</span>
                <span><span class="k">Ctrl+â†µ</span> create</span>
            </div>
        </div>
    </form>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script>
        const ed=document.getElementById('ed'),gut=document.getElementById('gut'),pre=document.getElementById('pre'),ls=document.getElementById('lang-select'),lg=document.getElementById('lg');
        function upd(){const n=ed.value.split('\n').length;gut.innerHTML=Array.from({length:n},(_,i)=>`<div>${i+1}</div>`).join('');document.getElementById('ln').textContent=n+(n===1?' line':' lines');document.getElementById('ch').textContent=ed.value.length+' chars';hl()}
        function hl(){const l=ls.value,c=ed.value||' ';lg.textContent=ls.options[ls.selectedIndex].text.slice(0,10);if(l&&l!=='plaintext'&&Prism.languages[l]){pre.innerHTML=`<code class="language-${l}">${Prism.highlight(c,Prism.languages[l],l)}</code>`;ed.classList.add('hl')}else{pre.innerHTML='';ed.classList.remove('hl')}}
        ed.addEventListener('input',upd);
        ed.addEventListener('scroll',()=>{gut.scrollTop=ed.scrollTop;pre.scrollTop=ed.scrollTop;pre.scrollLeft=ed.scrollLeft});
        ls.addEventListener('change',()=>{Prism.plugins.autoloader.loadLanguages([ls.value],hl);hl()});
        function toggleP(){const b=document.getElementById('pub'),i=document.getElementById('is_public');b.classList.toggle('on');i.value=b.classList.contains('on');b.querySelector('span').textContent=b.classList.contains('on')?'Public':'Private'}
        function toggleB(){const b=document.getElementById('burn'),i=document.getElementById('burn_after_read');b.classList.toggle('on');i.value=b.classList.contains('on')}
        ed.addEventListener('keydown',e=>{if(e.key==='Tab'){e.preventDefault();const s=ed.selectionStart,n=ed.selectionEnd;ed.value=ed.value.substring(0,s)+'    '+ed.value.substring(n);ed.selectionStart=ed.selectionEnd=s+4;upd()}});
        upd();
    </script>
</body>
</html>
